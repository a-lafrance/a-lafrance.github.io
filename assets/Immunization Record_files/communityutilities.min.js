$$WPUtil.guaranteeExistence($$WP,"CommunityUtilities");$$WP.CommunityUtilities.openDeepLink=function(u,g,l,e,o,p,k){var f=null,a="community.externaljump",h="externalJumpWindow",i="object",n=[],b,j;if(!g||typeof g!==i){$$WP.Debug.log("Organization passed in to the function is null or not an object.");return}if($$WPUtil.IsNullOrEmpty(k)||isNaN(k))k="-1";if(!e)e=$$WP.CommunityUtilities.openDeepLinkType.InPopup;if(g.IsSSO)e=$$WP.CommunityUtilities.openDeepLinkType.InNewTab;if(!$$WPUtil.IsNullOrEmpty(l)&&typeof l===i)for(var r in l)n.push({Name:r,Value:l[r]});j=document.location.protocol+"//"+document.location.hostname;if(!$$WPUtil.IsNullOrEmpty(document.location.port))j=j+":"+document.location.port;n.push({Name:"parentJumpGUID",Value:$$WP.CommunityUtilities.getExternalJumpGUID()},{Name:"parentDomain",Value:j},{Name:"lang",Value:MyChartLocale});var d={};d.mode=u;d.orgID=g.OrganizationId;d.parameters=n;d.patientIndex=k;closeAllWindows(h);var t=function(d){if(d&&typeof d==="string")d=$.parseJSON(d);if(d&&d.CommunityResponse&&!$$WPUtil.IsNullOrEmpty(d.CommunityResponse.RedirectURL)){if(!e){c.loadIframe(d);$$WP.CommunityUtilities.logDeepLinkAudit("3",g.OrganizationId);d.RedirectToSignup&&$$WP.CommunityUtilities.markCommunityLinkDirty(g.OrganizationId)}else if(b&&b._Components&&b._Components.length>0){$$WP.Strings.setOrganization(d.CommunityResponse.Organization,a);var h=[new $$WPComp.ComplexObjects.Button($$WP.Strings.getForTemplate("Continue",a),f,"completeworkflow","continue"),new $$WPComp.ComplexObjects.Button($$WP.Strings.getForTemplate("cancel",a),f,"previousstep","cancel")];b._Components[0].setMessage($$WP.Strings.get("redirectMessage",a));b._Components[0].CallbackArgs=[d];b._Components[0].setToolbar(h);b.setFocus();b.$container.trigger("resize");$$WP.Strings.clearOrganization(a)}}else q()},s=function(a,k){if(k==="toolbarcontinue"){if(typeof a==="string")a=$.parseJSON(a);if(typeof a===i){var d,f;if(e===$$WP.CommunityUtilities.openDeepLinkType.InNewTab)d="";else if(e===$$WP.CommunityUtilities.openDeepLinkType.InNewWindow)d="scrollbars=1,resizable=1";if(a.CommunityResponse.IsSSOPost)f="";else f=a.CommunityResponse.RedirectURL;openWindow(a.CommunityResponse.RedirectURL,"",d,h,true);$$WP.CommunityUtilities.logDeepLinkAudit("4",g.OrganizationId);a.RedirectToSignup&&$$WP.CommunityUtilities.markCommunityLinkDirty(g.OrganizationId);if(a.CommunityResponse.IsSSOPost){var j,b,c;c=getCookie(h,true);if(c==="")b=0;else b=c.split("^").length;j="mycWin"+makeLink("")+b;$$WPUtil.postForm(a.CommunityResponse.RedirectURL,a.CommunityResponse.parameters,j)}}}},q=function(){var g=c.callback;c.callback=f;!e&&c&&c.dispose();b.hide();var d=new $$WPComp.MessageComponent({Message:$$WP.Strings.get("externalLinkErrorMessage",a),callback:function(){c.runCallback(g)}}),h=new $$WPUtil.quickPopup(d);d.show();h.show()};if(e!==0){d.access="4";b=$$WPUtil.quickMessageBox("<img src='"+makeStaticLink("images/spinner64.gif")+"' class='loadingSpinner' alt='"+$$WP.Strings.get("GenericLoadingMessage","Global")+"'/>",f,[],s,f,"externalJumpRequestPopup Popup")}else{d.access="3";var c,m;m={};if(o&&p){m.callback=o;m.context=p}c=new $$WPComp.ExternalJumpPopupComponent(m);c.initialize();b=new $$WPContain.Popup({Components:[c],positioningFunction:$$WPContain.Positions.InsideCentered,Size:$$WPContain.Popup.SizeEnum.LARGE,Class:"externaljumppopup",CommunicationsIndicator:false,BackButtonText:$$WP.Strings.get("ExitPopup",a)});b.show(true)}d=$$WPUtil.postify(d);getCSRFTokenAsQS(function(){$.ajax({url:makeLink("ExternalJump/GetExternalJumpUrl"),type:"POST",data:d,dataType:"json",error:q,cache:false,success:t})})};$$WP.CommunityUtilities.openDeepLinkType={InPopup:0,InNewTab:1,InNewWindow:2};$$WP.CommunityUtilities.logDeepLinkAudit=function logDeepLinkAudit(b,c){var a={};a.access=b;a.orgID=c;getCSRFTokenAsQS(function(){$.ajax({url:makeLink("ExternalJump/LogExternalJumpAudit"),type:"POST",data:a,cache:false})})};$$WP.CommunityUtilities.markCommunityLinkDirty=function markCommunityLinkDirty(b){var a={};a.organizationId=b;getCSRFTokenAsQS(function(){$.ajax({url:makeLink("Community/External/MarkCommunityLinkDirty"),type:"POST",data:a,cache:false})})};$$WP.CommunityUtilities.refreshCommunityLink=function refreshCommunityLink(b){var a={};a.organizationId=b;getCSRFTokenAsQS(function(){$.ajax({url:makeLink("Community/External/RefreshCommunityLink"),type:"POST",data:a,cache:false})});location.reload()};$$WP.CommunityUtilities.getExternalJumpGUID=function getExternalJumpGUID(){if($$WPUtil.IsNullOrEmpty($$WP.CommunityUtilities._externalJumpGUID))$$WP.CommunityUtilities._externalJumpGUID=$$WPUtil.generateRandomGUID();return $$WP.CommunityUtilities._externalJumpGUID};$$WP.CommunityUtilities.getParentJumpGUID=function getParentJumpGUID(){return!$$WPUtil.IsNullOrEmpty($$WP.CommunityUtilities._parentJumpGUID)?$$WP.CommunityUtilities._parentJumpGUID:""};$$WP.CommunityUtilities.clearJumpGUIDs=function clearJumpGUIDs(){$$WP.CommunityUtilities._externalJumpGUID=null;$$WP.CommunityUtilities._parentJumpGUID=null};$$WP.CommunityUtilities.setJumpParameters=function setJumpGUIDs(a,b){if(!$$WPUtil.IsNullOrEmpty(a))$$WP.CommunityUtilities._parentJumpGUID=a;if(!$$WPUtil.IsNullOrEmpty(b))$$WP.CommunityUtilities._parentDomain=b};$$WP.CommunityUtilities.getParentDomain=function getParentDomain(){return!$$WPUtil.IsNullOrEmpty($$WP.CommunityUtilities._parentDomain)?$$WP.CommunityUtilities._parentDomain:""};$$WP.CommunityUtilities.closeExternalParentPopup=function closeExternalParentPopup(){var a={},b;a.externalGUID=$$WP.CommunityUtilities.getParentJumpGUID();a.message="closePopup";b=$$WP.CommunityUtilities.getParentDomain();if(parent)try{parent.postMessage(JSON.stringify(a),b)}catch(c){console.error("Invalid Parent Domain")}WP.Comm.logOut();$$WP.CommunityUtilities.clearJumpGUIDs();$$WP.CommunityUtilities._parentDomain=null;if(self===top)self.location=makeLink("home/logout")};$$WP.CommunityUtilities.externalJumpMessageListener=function externalJumpMessageListener(a){var c=$$WP.CommunityUtilities.getParentDomain();if(a&&a.originalEvent&&a.originalEvent.origin===c&&a.originalEvent.data){var b=JSON.parse(a.originalEvent.data);if(b.message==="logout"){WP.Comm.logOut();$$WP.CommunityUtilities.clearJumpGUIDs()}else if(b.message==="valid")$$WP._isExternalJumpParentValid=true}};$$WP.CommunityUtilities.checkIfCommunityJumpIsValid=function checkIfCommunityJumpIsValid(){var a=$afe.select("body");if(a.hasClass("md_default")&&!a.hasClass("isPrelogin")&&!a.hasClass("PUpage"))self.location=makeLink("closeExternalJumpPopup.asp");else if(self!==top){var b={},c;b.message="isValidContext";b.externalGUID=$$WP.CommunityUtilities.getParentJumpGUID();c=$$WP.CommunityUtilities.getParentDomain();try{parent.postMessage(JSON.stringify(b),c)}catch(d){console.error("Parent Domain Validation failed")}setTimeout(function(){!$$WP._isExternalJumpParentValid&&top.location.replace(makeLink("home/logout"))},1e3)}};$$WP.CommunityUtilities.openDeepLinkUrl=function(g,f,b,c,d){var a=$$WPUtil.parseQueryString(g),e=a.mode;delete a.mode;$$WP.CommunityUtilities.openDeepLink(e,f,a,b,c,d)};$$WP.CommunityUtilities.ShowSignUpNotAllowedMessage=function(b){var a;$$WP.Strings.setDefaultNamespace("community.externallinking");$$WP.Strings.setOrganization(b);a=$$WP.Strings.get("SignupNotAllowedMessage");$$WP.Strings.clearOrganization();$$WPUtil.quickMessageBox(a,"",[],null,null,"SignupNotAllowed");$afe.select(".SignupNotAllowed.component.Popup").removeClass("textlessTitle");$$WP.Strings.clearDefaultNamespace()};$$WP.CommunityUtilities.hasCommunityLinks=function hasCommunityLinks(){return $afe.select("body").hasClass("hasNoCommunityLinks")?false:true};$$WP.CommunityUtilities.communityChecksuccesscallback=function communityChecksuccesscallback(b){var c,a;if(b!==null&&typeof b!=="undefined"){a=b.isCommunityActive;if(a)c="hasCommunityLinks";else c="hasNoCommunityLinks";$.ajax({url:makeLink("session.asp?mode=updateCommunityActiveCheckFlags&IsCommunityActive="+a)});getCSRFTokenAsQS(function(){$.ajax({url:makeLink("Community/External/UpdateCommunityActiveCheckFlags"),type:"POST"})});$afe.select("body").removeClass("hasNoCommunityLinks hasCommunityLinks").addClass(c)}};$$WP.CommunityUtilities.clearCommunityLinksSessionStatus=function clearCommunityLinksSessionStatus(){$.ajax({url:makeLink("session.asp?mode=clearCommunityActiveCheckFlags")});getCSRFTokenAsQS(function(){$.ajax({url:makeLink("Community/External/ClearCommunityActiveCheckFlags"),type:"POST"})})};$$WP.CommunityUtilities.checkIfCommunityLinksAvailable=function checkIfCommunityLinksAvailable(){var a=$afe.select("body");if(a.hasClass("isPrelogin")||a.hasClass("termsPage"))return;getCSRFTokenAsQS(function(){$.ajax({url:makeLink("Community/External/IsCommunityActive"),dataType:"JSON",type:"POST",cache:false,success:$$WP.CommunityUtilities.communityChecksuccesscallback,failure:function(){$$WP.Debug.log("Community Links available ajax called failed.")}})})};$$WP.CommunityUtilities.getCommunityLinks=function(d,a,c,e){a=a||"*";d=d||function(){};e=e||window;c=c||[];var b=$$WP.CommunityUtilities.getCommunityLinks;if(b._links[a]){c.push(b._links[a]);return d.apply(e,c)}b._callback=d;b._args=c;b._context=e;b._waitingFor=a;getCSRFTokenAsQS(function(){$.ajax({url:makeLink("ExternalJump/GetCommunityLinks?requireSecurityForMode="+a),dataType:"JSON",type:"POST",cache:false,success:$$WP.CommunityUtilities.getCommunityLinks.callStack,failure:function(){$$WP.CommunityUtilities.getCommunityLinks.callStack({ForMode:a,Organizations:[]})}})})};$$WP.CommunityUtilities.getCommunityLinks.callStack=function(b){var a=$$WP.CommunityUtilities.getCommunityLinks;a._links[b.ForMode]=b.Organizations;if(b.ForMode===a._waitingFor&&typeof a._callback==="function"){a._args.push(b.Organizations);a._callback.apply(a._context,a._args)}a._waitingFor=null;a._callback=null};$$WP.CommunityUtilities.getCommunityLinks._links={};$$WP.CommunityUtilities.pickOrganization=function pickOrganization(b,d,a,c){$$WP.CommunityUtilities.getCommunityLinks(function getCommunityLinks(c){if(!c||c.length===0){a.push("1");b.apply(this,a);return}if(c.length===1){a.push(c[0]);b.apply(this,a);return}var h,i,g=[],e,f;f=c.length;if(f>3)f=3;for(e=0;e<c.length;e++)g.push(new $$WPComp.ComplexObjects.Button(new Handlebars.SafeString("<span class='orglogo roundedimage' style='background-image:url("+c[e].LogoUrl+");'></span> <span class='orgname'>"+c[e].OrganizationName+"</span>"),null,"CommunityLink community_"+f,e));h=new $$WPComp.MessageComponent({Message:d,callback:function(){if(arguments[arguments.length-1]==="close")return;arguments[arguments.length-1]=arguments[arguments.length-1].substr($$WPComp.TOOLBARIDENTIFIER.length);arguments[arguments.length-1]=this.links[arguments[arguments.length-1]];this.fun.apply(this,arguments)},CallbackArgs:a,CallbackContext:{links:c,fun:b},ToolbarButtons:g});i=$$WPUtil.quickPopup(h,{Size:g.length<3?$$WPContain.Popup.SizeEnum.SMALL:$$WPContain.Popup.SizeEnum.MEDIUM,Class:"PickOrganization"});i.show()},c)};$$WP.CommunityUtilities.getOrganization=function(d,c,b,a){if(typeof c!="function")return;a=a||window;b=b||[];$$WP.CommunityUtilities.getCommunityLinks(function(){for(var e=arguments[0],d=arguments[1],c=arguments[2],b=arguments[3],a=0;a<b.length;a++)if(b[a].OrganizationId===e){c.push(b[a]);break}d.apply(this,c)},null,[d,c,b],a)}