/*! Copyright (c) Epic Systems Corporation 2009-2017 */
var formatCalendarTitle=buildFormat("MMMM yyyy"),formatCalendarDate=buildFormat("<\\span cla\\s\\s=\"clearlabel\">dddd, MMMM </\\span>d<\\span cla\\s\\s=\"clearlabel\">, yyyy</\\span>"),_dateChooser;function callback(c,b,a){document.forms[0].year.value=c;document.forms[0].month.value=getMonthName(b+1);document.forms[0].day.value=a}function createClickFunction(a){function f(b){var e="currentselected",c=WP.Events.getThis(b),d;while(c.nodeName.toUpperCase()!=="TD")c=c.parentNode;d=c.id||c.getAttribute("name");if(d==="calnext"){_dateChooser.drawNextMonth();WP.Events.cancelEvent(b);WP.Events.preventDefault(b);return false}if(d==="calprev"){_dateChooser.drawPreviousMonth();WP.Events.cancelEvent(b);WP.Events.preventDefault(b);return false}if(d==="calcancel"){_dateChooser.clearCalendar();return}_dateChooser.date=d.replace("cal","");$afe.select(".currentselected").removeClass(e);$afe.jq(c).addClass(e);a.call(_dateChooser,_dateChooser.year,_dateChooser.month,d.replace("cal",""),_dateChooser.input);_dateChooser.clearCalendar();WP.Events.cancelEvent(b);WP.Events.preventDefault(b);return false}return f}function DateChooser(d,c,e,b,f){var a=this;a.trigger=d;a.callback=c;a.input=f;a.filter=e||function(){return true};if(b&&typeof b.getYear==="function")a.today=b;else if(typeof b==="string"){a.today=new Date(b);if(isNaN(a.today))a.today=new Date}else a.today=new Date;a.month=a.today.getMonth();a.year=a.today.getFullYear();a.date=a.today.getDate();a.calendar=null;a.clickFunction=createClickFunction(c);a.hoverText="Click to select";a.hoverTextDisabled="Not Available"}function isInCalendar(c){var b,a;for(a=c,b=0;a&&b<6;a=a.parentNode,b++)if(a&&a.id&&a.id.toLowerCase()==="calendar")return true;return false}function lo(b){var a=WP.Events.getThis(b);while(a.nodeName.toUpperCase()!=="TD")a=a.parentNode;$afe.jq(a).removeClass("hi")}function hi(b,a){return function(d){var c=WP.Events.getThis(d);if(a)while(c.nodeName.toUpperCase()!=="DIV")c=c.parentNode;else while(c.nodeName.toUpperCase()!=="TD")c=c.parentNode;$afe.jq(c).addClass("hi");if((!$afe.jq(c).hasClass("ctrl")||b)&&_dateChooser.focusOn&&_dateChooser.focusOn!==c.id){lo({target:document.getElementById(_dateChooser.focusOn),srcElement:document.getElementById(_dateChooser.focusOn)});_dateChooser.focusOn=c.id}}}function restoreHi(c){var b=WP.Events.getThis(c),a;if(b&&b.className!=="calendar"&&!isInCalendar(b)){a="cal"+_dateChooser.date;if(_dateChooser.focusOn&&a!==_dateChooser.focusOn)if(_dateChooser.month===_dateChooser.today.getMonth()&&_dateChooser.year===_dateChooser.today.getFullYear()&&document.getElementById(a).firstChild.tagName)document.getElementById(a).firstChild.focus();else{a=document.getElementById(_dateChooser.focusOn);a.firstChild&&a.firstChild.blur();lo({target:a,srcElement:a})}}}function _removeCalendar(b){var a=$afe.select("#calendar");if(a.length>0){if(a.hasClass("alwaysshown")&&!b)return;WP.Events.removeListener(document.body,"click",removeCalendar);WP.Events.removeListener(document.body,"mouseover",restoreHi);accessibilityRestorePage();a.remove();_dateChooser=null}}function removeCalendar(b){var a=WP.Events.getThis(b);a&&a.className!=="calendar"&&!isInCalendar(a)&&_removeCalendar()}function keyOnPrevMonth(b){var a;if(b.keyCode===9){if(b.shiftKey&&!IsCalendarAlwaysShown(this)){a=document.getElementById("calcancel").firstChild;if(a&&a.nodeName.toUpperCase()==="A")a.focus();else document.getElementById("cal"+_dateChooser.lastDate).firstChild.focus();return WP.Events.preventDefault(b)}return}if(b.keyCode===13)_dateChooser.wasEnter=true}function keyOnNextMonth(b){var a;if(b.keyCode===9){if(b.shiftKey&&!IsCalendarAlwaysShown(this)){a=document.getElementById("calprev").firstChild;if(!a||a.nodeName.toUpperCase()!=="A"){a=document.getElementById("calcancel").firstChild;if(a&&a.nodeName.toUpperCase()==="A")a.focus();else document.getElementById("cal"+_dateChooser.lastDate).firstChild.focus();return WP.Events.preventDefault(b)}}return}if(b.keyCode===13)_dateChooser.wasEnter=true}function tabOnCancel(b){var a;if(b.keyCode===9){if(b.shiftKey||IsCalendarAlwaysShown(this))return;a=document.getElementById("calprev").firstChild;if(a&&a.nodeName.toUpperCase()==="A")a.focus();else{a=document.getElementById("calnext").firstChild;if(a&&a.nodeName.toUpperCase()==="A")a.focus();else document.getElementById("cal"+_dateChooser.firstDate).firstChild.focus()}return WP.Events.preventDefault(b)}else b.keyCode===13&&$afe.select("#calendar").hasClass("alwaysshown")&&document.getElementById("taboutcatcher").focus()}function IsCalendarAlwaysShown(b){var a=$afe.jq(b).closest("#calendar");return a.is(".calendar.alwaysshown")?true:false}DateChooser.prototype.drawCalendar=function(d){var o="keydown",c="cal",r="alwaysshown",q="clearlabel",n="taboutcatcher",m="calendar",a=this;_removeCalendar(true);_dateChooser=a;var b=document.createElement("div"),g,s,f,h,p,i,e,l,k,j;i=new Date;b.id=m;b.className=m;b.setAttribute("role","listbox");b.appendChild(a.getCalendarObject());a.setClickFunction(b);p=document.documentElement.className.indexOf("mobile")>=0;if(a.trigger.offsetParent&&!d){b.style.position="absolute";g=getElementPosition(a.trigger);s=g.topElement;s.appendChild(b);b.style.zIndex=4001;b.style.left=g.x;b.style.top=g.y;f=document.getElementById("main")||document.getElementById("datatile");if(isDataTile()){j=$afe.select("#"+a.trigger.id).parents(".Popup");l=f.offsetWidth;k=f.offsetHeight;if(j!==null&&j.length>0){f=j;l=f.outerWidth();k=f.outerHeight()}}g=getElementPosition(a.trigger,f);if(b.offsetWidth){h=parseInt(g.x,10)+b.offsetWidth-l;if(h>0)b.style.left=parseInt(b.style.left,10)-h+"px"}if(b.offsetHeight){h=parseInt(g.y,10)+b.offsetHeight-k;if(h>0)b.style.top=parseInt(b.style.top,10)-h+"px"}if(p){b.style.left="0px";b.style.position="fixed";b.style.top="0px"}}else if(!d){$afe.jq(a.trigger.parentNode).safeInsertBefore(b,a.trigger);$afe.jq(a.trigger).addClass("hidden")}else{if(!document.getElementById(n)){e=document.createElement("a");applyClass(e,q);e.id=n;e.href="#";$afe.jq(e).safeInsertAfter(a.trigger.parentNode)}else e=document.getElementById(n);$afe.jq(b).safeInsertBefore(e);$afe.jq(a.trigger).addClass("hidden")}if(d===true){$afe.jq(b).addClass(r);$afe.select("#calcancel").addClass(q)}else $afe.select(".currentselected").removeClass("currentselect");a.calendar=b;WP.Events.addListener(document.body,"click",removeCalendar);WP.Events.addListener(document.body,"mouseover",restoreHi);if(a.month===a.today.getMonth()&&a.year===a.today.getFullYear()&&document.getElementById(c+i.getDate()).firstChild.tagName){document.getElementById(c+a.date).firstChild.focus();a.focusOn=c+a.date}else if(a.wasEnter){document.getElementById(c+a.firstDate).firstChild.focus();a.focusOn=c+a.firstDate}if(d&&!a.firstDate){_dateChooser.drawNextMonth();return}if(d&&a.month===i.getMonth()&&a.year===i.getFullYear()&&!document.getElementById(c+i.getDate()).firstChild.tagName){applyClass(document.getElementById(c+i.getDate()),"n");document.getElementById(c+a.firstDate).firstChild.focus();a.focusOn=c+a.firstDate}if(d&&!a.focusOn)a.focusOn=c+a.firstDate;WP.Events.addListener(document.getElementById("calprev"),o,keyOnPrevMonth);WP.Events.addListener(document.getElementById("calnext"),o,keyOnNextMonth);WP.Events.addListener(document.getElementById("calcancel"),o,tabOnCancel);!d&&accessibilityHidePage();a.firstDate="";a.lastDate="";if(p)$afe.jq(b).on("touchmove",function(a){$$WP.Utilities.Mobile.Optimization.IgnoreTouchMove(a,true)});containsClassName(document.getElementById(m),r)&&WP.Events.fireEvent(document.getElementById("datechooser"),"change")};DateChooser.prototype.clearCalendar=function(){var a=this;_removeCalendar();a.callback();if(containsClassName(a.calendar,"alwaysshown"))return;a.trigger.className=a.trigger.className.replace(" hidden","");a.trigger.parentNode.focus()};DateChooser.prototype.setClickFunction=function(l){var d=this;for(var j=d.hoverText,i=d.hoverTextDisabled,m=d.clickFunction,h=l.getElementsByTagName("td"),a,b,f=new Date,k=document.all?"hand":"pointer",e=function(a,c){var b="mouseover";WP.Events.addListener(a,"click",m);if(a.className==="ctrl"){WP.Events.addListener(a,b,hi());WP.Events.addListener(a,"mouseout",lo);WP.Events.addListener(a.firstChild,"focus",hi(true));WP.Events.addListener(a.firstChild,"blur",lo)}else{WP.Events.addListener(a,b,function(){a.firstChild.focus()});WP.Events.addListener(a.firstChild,"focus",hi())}a.style.cursor=k;if(c!==true)a.title=j},c=function(a){a.style.cursor="default";a.title=i},g=0;g<h.length;++g){a=h[g];b=a.className;if(b==="null"||b==="hdr"||!a.firstChild)continue;if(b==="ctrl")e(a,true);else if(b.indexOf("othermonth")>0)c(a);else if(b.indexOf("n")===0)c(a);else if(b.indexOf("wkndn")===0)c(a);else if(b==="ctrln")c(a);else if(b!=="today")e(a);else if(d.filter(f.getFullYear(),f.getMonth(),f.getDate()))e(a);else c(a)}};DateChooser.prototype.drawNextMonth=function(){var a=this,c=false;if(a.calendar.className.indexOf("alwaysshown")>-1)c=true;a.clearCalendar();a.month=(a.month+1)%12;if(a.month===0)a.year++;a.drawCalendar(c);if(!a.wasEnter&&a.month!==a.today.getMonth()){var b=document.getElementById("calnext");if(b!==null){b=b.firstChild;b&&b.nodeName.toUpperCase()==="A"&&b.focus()}}};DateChooser.prototype.drawPreviousMonth=function(){var a=this,c=false;if(a.calendar.className.indexOf("alwaysshown")>-1)c=true;a.clearCalendar();a.month=a.month-1;if(a.month<0)a.month+=12;if(a.month===11)a.year--;a.drawCalendar(c);if(!a.wasEnter&&a.month!==a.today.getMonth()){var b=document.getElementById("calprev").firstChild;b&&b.nodeName.toUpperCase()==="A"&&b.focus()}};DateChooser.prototype.getCalendarObject=function(){var B="&raquo;",r="true",q="aria-hidden",v="Button",m="role",A="&laquo;",f="",l="ctrl",k="td",p="tr",g=this,u=document.createElement("table"),y=document.createElement("thead"),x=document.createElement("tbody"),e,a,o,b=g.month,d=g.year,C=g.filter,t,j,c,z=new Date,G=z.getDate(),E=z.getMonth(),F=z.getFullYear(),h=WP.DOM.Create.tag,i=function(b,d){var c=1,a=makeDate(d,b+1,c);b=a.getMonth();while(a.getMonth()===b){if(C(a.getFullYear(),a.getMonth(),c))return true;a.setDate(++c)}return false};j=!i(b,d);e=document.createElement(p);if(i(b-1,d)||j){a=h(k,l+(i(b-1,d)||j?f:"n"),"calprev",formatCalendarTitle(makeDate(d,b)));a.appendChild(WP.DOM.Create.anchoredNode(A,false,formatCalendarTitle(makeDate(d,b))));a.setAttribute(m,v)}else{a=h(k,l+(i(b-1,d)||j?f:"n"),"calprev",formatCalendarTitle(makeDate(d,b)),A);a.setAttribute(q,r)}e.appendChild(a);e.appendChild(h("th","hdr calmonth",f,f,formatCalendarTitle(makeDate(d,b+1))));e.lastChild.colSpan=5;if(i(b+1,d)||j){a=h(k,l+(i(b+1,d)||j?f:"n"),"calnext",formatCalendarTitle(makeDate(d,b+2)));a.appendChild(WP.DOM.Create.anchoredNode(B,false,formatCalendarTitle(makeDate(d,b+2))));a.setAttribute(m,v)}else{a=h(k,l+(i(b+1,d)||j?f:"n"),"calnext",formatCalendarTitle(makeDate(d,b+2)),B);a.setAttribute(q,r)}e.appendChild(a);y.appendChild(e);e=document.createElement(p);for(t=0;t<7;t++){a=h("th","hdr",f,f,getDayLetter((t+getFirstDayOfWeek())%7));$afe.jq(a).safeAttr(q,r);e.appendChild(a)}y.appendChild(e);u.appendChild(y);var n,D=function(a,e){var d=a.getMonth(),h=a.getDate(),j=a.getFullYear(),g,i=a.getDay(),c;if(d===b&&d===E&&h===G&&j===F)return"today";g=e?" othermonth":f;c=i===0||i===6;return C(j,d,h)&&!e?c?"wknd":"d":(c?"wkndn":"n")+g},s,w;c=makeDate(d,b+1,1);s=c.getDay()-getFirstDayOfWeek();if(s<0)s+=7;c.setDate(c.getDate()-s);while(c.getMonth()!==b+1&&c.getFullYear()<=d){e=document.createElement(p);for(w=0;w<7;w++){n=c.getMonth()!==b;a=h(k,D(c,n),n?f:"cal"+c.getDate());if(!n&&g.filter(d,b,c.getDate())){o=WP.DOM.Create.anchoredNode(formatCalendarDate(c),true);o.setAttribute(m,"option");if(!g.firstDate||g.firstDate===f)g.firstDate=c.getDate();if(!g.lastDate||g.lastDate<c.getDate())g.lastDate=c.getDate()}else{o=document.createElement("span");a.setAttribute(q,r);o.textContent=n?f:c.getDate()}a.appendChild(o);c.getTime()===_dateChooser.today.getTime()&&applyClass(a,"currentselected");e.appendChild(a);c.setDate(c.getDate()+1)}x.appendChild(e)}e=document.createElement(p);a=h(k,l,"calcancel","Cancel date selection - tab forward to change months");a.setAttribute(m,v);a.appendChild(WP.DOM.Create.anchoredNode("Cancel"));e.appendChild(a);e.firstChild.colSpan=7;x.appendChild(e);$afe.jq(u).safeAttr(m,"presentation");u.appendChild(x);return u};function dfltClndrCallbackFactory(a){return function(e,c,d){var b=document.getElementById(a);if(b){b.holdErrors=false;b.openingCalendar=false;if(e&&!isNaN(c)&&c>-1&&c<12&&d){b.value=formatDate(new Date(e,c,d));_dateChooser.today=parseDate(b.value,true);WP.Events.fireEvent(b,"change");b.focus()}}}}function textBoxDataChooser(g,d,h,a,f){var b,e,c;c=document.getElementById(d);if(typeof a==="string"&&a.length>0)b=window[a](d);else if($.isFunction(a))b=a;if(typeof b!=="function")b=dfltClndrCallbackFactory(d);e=new DateChooser(g,b,WP.Validators.Calendar[h],parseDate(c.value,true),c);e.drawCalendar(f)}function writeCalendar(a,f,k,g,h,j,i){var b=false,c="holdErrors",e="openingCalendar",d;if(typeof a==="string")a=$afe.select("#"+a);d=$$WP.SimpleTemplates.Anchor({href:"#","class":"calendar datechooserAnchor"});d.safeAppend($$WP.SimpleTemplates.Img({src:k,alt:"Calendar - Use to Select a Date"}));if(f==="range"){if(!$$WPUtil.IsNullOrEmpty(g))window.cachedStartDate=WP.Utils.dte2date(g);if(!$$WPUtil.IsNullOrEmpty(h))window.cachedEndDate=WP.Utils.dte2date(h)}d.click(function(){a.prop(e,true);a.prop(c,b);textBoxDataChooser(d[0],a.prop("id"),f,j,i);$afe.jq(window).trigger("matchColumnHeights");return b}).on("mousedown",function(){a.prop(c,true)}).on("mouseout",function(){a.prop(c,b);a.prop(e,b)});d.safeInsertAfter(a)}function clearCalendarDateRange(){window.cachedStartDate=null;window.cachedEndDate=null}function pageLo(b){var a=WP.Events.getThis(b);while(a.nodeName.toUpperCase()!=="DIV")a=a.parentNode;$afe.jq(a).removeClass("hover")}function pageHi(){return function(b){var a=WP.Events.getThis(b);while(a.nodeName.toUpperCase()!=="DIV")a=a.parentNode;$afe.jq(a).addClass("hover");_dateChooser.focusOn&&_dateChooser.focusOn!==a.id&&pageLo({target:document.getElementById(_dateChooser.focusOn),srcElement:document.getElementById(_dateChooser.focusOn)});_dateChooser.focusOn=a.id}}function pageCalendarEffects(){var d,b,c,a;d=document.getElementById("pagecalendar");if(d!==null){_dateChooser=function(){};b=d.getElementsByTagName("div");if(b!==null)for(c=0;c<b.length;c++){a=b[c];if($afe.jq(a).hasClass("NoData")||$afe.jq(a).hasClass("EditData")||$afe.jq(a).hasClass("ctrl")){WP.Events.addListener(a,"mouseover",function(){this.firstChild.focus()});WP.Events.addListener(a,"mouseout",function(){this.firstChild.blur()});WP.Events.addListener(a.firstChild,"focus",pageHi());WP.Events.addListener(a.firstChild,"blur",pageLo)}}}}function accessibilityHidePage(){var a=accessibilityGetElements();for(i=0;i<a.length;i++)a[i]&&a[i].setAttribute("aria-hidden","true")}function accessibilityRestorePage(){var a=accessibilityGetElements();for(i=0;i<a.length;i++)a[i]&&a[i].removeAttribute("aria-hidden")}function accessibilityGetElements(){return[document.getElementById("header"),document.getElementById("footer"),document.getElementById("content")]}$$WP.Utilities.UI.Calendars=function $$WP$Utilities$UI$Calendars(b){var a;if(b.type==="load"){a=$afe.select("input.date.withCalendar");a.each(function(){var a=$afe.jq(this);!a.next().is("a.datechooserAnchor")&&writeCalendar(a,a.safeAttr("data-filter"),makeStaticLink("images/calendar.png"),a.safeAttr("data-filter-from"),a.safeAttr("data-filter-to"),a.safeAttr("data-callback"))})}};$$WP.Utilities.UI.Map.Support.calendars=$$WP.Utilities.UI.Calendars